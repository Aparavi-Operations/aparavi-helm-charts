apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "aparavi.fullname" . }}-platform
  labels:
    {{- include "aparavi.labels" . | nindent 4 }}
    component: platform
data:
  config.sh: |
    #!/bin/bash

    tar -xf "${ARTIFACT}"
    rm "${ARTIFACT}"
    ./node app/webserver.js \
      --moduleType=platform \
      --config.node.nodeName=platform \
      --config.keyStore.dialect=redis \
      --config.keyStore.host={{ .Values.redis.host }} \
      --config.keyStore.port={{ .Values.redis.port }} \
      --config.keyStore.password={{ .Values.redis.password }} \
      --config.database.dialect=mysql \
      --config.database.host={{ .Values.mysql.host }} \
      --config.database.port={{ .Values.mysql.port }} \
      --config.database.user={{ .Values.mysql.user }} \
      --config.database.password={{ .Values.mysql.password }}
